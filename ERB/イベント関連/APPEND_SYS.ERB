;FileName_APPEND_SYS.ERB --------------------------- Rev1.00
;era命蓮寺_システム変更系イベント統括
;CALL		USER
;ARG		VOID
;RETURN		VOID
;COMMENT	
;-----------------------------------------------------------
;EVENT_NO_LIST ============================== FLAG:1
;FLAG:1=1 霊廟メンバー出現イベント
;FLAG:1=2 猯藏来訪イベント
;FLAG:1=3 命蓮寺メンバー追加イベント
;FLAG:1=4 
;FLAG:1=5 

@SYS_EVENT
;--- イベント自己定義ブロック ---

;--- イベント実行ブロック ---

;	;自宅にSUMIKOMI_ROOMが設定されている
	IF HOUGONG
		IF FLAG:住宿人物 >= 0 && !FLAG:住宿事件 && SUMIKOMI_ROOM && CFLAG:MASTER:現在位置 != OMANEKIBEYA()
			CALL NEWMEMBER_ADD
		ENDIF
	ELSE
		IF FLAG:住宿人物== 0 && !FLAG:住宿事件 && SUMIKOMI_ROOM && CFLAG:MASTER:現在位置 != OMANEKIBEYA()
			CALL NEWMEMBER_ADD
		ENDIF
	ENDIF
;ENDIF



;以下、各イベント関数 ===============================

;住宿EX角色決定イベント
@NEWMEMBER_ADD
#DIM 人数
#DIM ROOM_N
#DIM C_ID
VARSET LOCAL
人数 = 0
FOR LOCAL,1,CHARANUM
	;既に住んでいるメンバーは除く
	SIF CFLAG:LOCAL:神社在住 > 0
		CONTINUE
	SIF TALENT:LOCAL:路人
		CONTINUE
	IF HOUGONG
		IF TALENT:LOCAL:恋慕 && EXP:LOCAL:愛情経験 >= 20
			人数 ++
			LOCAL:LOCAL = 1
			LOCALS = %CALLNAME:LOCAL%
		ENDIF
		IF TALENT:LOCAL:愛欲
			人数 ++
			LOCAL:LOCAL = 1
			LOCALS = %CALLNAME:LOCAL%
		ENDIF
	ELSE
		IF TALENT:LOCAL:恋慕 && EXP:LOCAL:愛情経験 >= 200 
			人数 ++
			LOCAL:LOCAL = 1
			LOCALS = %CALLNAME:LOCAL%
		ENDIF
	ENDIF
NEXT
IF HOUGONG
	SIF !人数
		RETURN
ELSE
	SIF !人数 || (DAY:3 != 1)
		RETURN
ENDIF
PRINTL
DRAWLINE
PRINTFORML 早上起床后、出现了来找%CALLNAME:MASTER%的来訪者

PRINTFORML %LOCALS%\@ 人数 > 1 ? 她们 # \@告诉%CALLNAME:MASTER%想在%GET_MAPNAME(MAIN_MAP)%定居生活
PRINTL
IF HOUGONG
	PRINTFORML 同意→入住后宫别墅
ELSEIF MAIN_MAP == 2
	PRINTFORML 因为長屋里面有空房间、所以搬家应该很容易吧
	IF TALENT:NameToID(LOCALS):人类
		PRINTFORMW %CALLNAME:拠点_家主%好像也没有什么特殊的拒绝理由
	ELSE
		PRINTFORMW %LOCALS%说只要对%CALLNAME:拠点_家主%隐瞒真实身份就可以了
	ENDIF
ELSE
	PRINTFORML 如果重新装修%NAME_FROM_PLACE(SUMIKOMI_ROOM)%的话，就可以一个人住了吧
	PRINTFORMW %CALLNAME:拠点_家主%好好说的话，会欢迎的
ENDIF
PRINTFORML %CALLNAME:MASTER%也同意…
C_ID = 1
FOR LOCAL,1,CHARANUM
	;既に住んでいるメンバーは除く
	SIF CFLAG:LOCAL:神社在住 > 0
		CONTINUE
	IF HOUGONG
		IF TALENT:LOCAL:恋慕 && EXP:LOCAL:愛情経験 >= 20
			C_ID = LOCAL
			PRINTFORML [{LOCAL}] - 同意%CALLNAME:LOCAL%入住神社
		ENDIF
		IF TALENT:LOCAL:愛欲
			C_ID = LOCAL
			PRINTFORML [{LOCAL}] - 同意%CALLNAME:LOCAL%入住神社
		ENDIF
	ELSE
		IF TALENT:LOCAL:恋慕 && EXP:LOCAL:愛情経験 >= 200
			C_ID = LOCAL
			PRINTFORML [{LOCAL}] - %CALLNAME:LOCAL%同意搬家
		ENDIF
	ENDIF
NEXT
PRINTFORML [999] - 拒绝
$INPUT_LOOP
INPUT
IF RESULT == 999
	PRINTFORMW %CALLNAME:MASTER%摇了摇头拒绝、%LOCALS%\@ 人数 > 1 ? 她们 # \@很遗憾的离開了%CALLNAME:MASTER%的房间
	;このやり方だと一人しか口上を呼べないんだが良い方法はないものか
	;とりあえず多数の場合にそれぞれの角色の口上を呼び出せるようにしてみる、ただし実際に出来るかどうかはテスト出来てないので自信は無い
	IF 人数 > 1
		FOR LOCAL,1,CHARANUM
			;既に住んでいるメンバーは除く
			SIF CFLAG:LOCAL:神社在住 > 0
				CONTINUE
			IF HOUGONG
				IF TALENT:LOCAL:恋慕 && EXP:LOCAL:愛情経験 >= 20
					CALL KOJO_MESSAGE_SEND("EVENT",19,LOCAL,2,0)
					PRINTL 
				ENDIF
				IF TALENT:LOCAL:愛欲
					CALL KOJO_MESSAGE_SEND("EVENT",19,LOCAL,2,0)
					PRINTL 
				ENDIF
			ELSE
				IF TALENT:LOCAL:恋慕 && EXP:LOCAL:愛情経験 >= 200
					CALL KOJO_MESSAGE_SEND("EVENT",19,LOCAL,2,0)
					PRINTL 
				ENDIF
			ENDIF
		NEXT
	ELSE
		CALL KOJO_MESSAGE_SEND("EVENT",19,C_ID,2,0)
	ENDIF
	RETURN 0
ELSEIF RESULT >= CHARANUM
	CLEARLINE 1
	GOTO INPUT_LOOP
ELSEIF !LOCAL:RESULT
	CLEARLINE 1
	GOTO INPUT_LOOP
ENDIF
PRINTFORML 拉起%CALLNAME:RESULT%的手、告诉他要去拜托%CALLNAME:拠点_家主%,%CALLNAME:RESULT%高兴地微笑着
PRINTFORMW 我马上去%CALLNAME:拠点_家主%那里拜托他、他很快就答应了…
PRINTL
PRINTFORMW - %CALLNAME:RESULT%成为了%GET_MAPNAME(MAIN_MAP)%的一员 -
PRINTL
FLAG:住宿人物= RESULT
CFLAG:(FLAG:住宿人物):311 = SUMIKOMI_ROOM
CFLAG:(FLAG:住宿人物):神社在住 = SUMIKOMI_ROOM

CALL KOJO_MESSAGE_SEND("EVENT",19,RESULT,1,0)

CALL ROOMSETTING