@HININSHITE(ARG)

IF ESTRUS_CYCLE(ARG) == 150
	LOCALS = 是容易怀上宝宝的危険日，
ELSEIF ESTRUS_CYCLE(ARG) != 15
	LOCALS = 不在安全期
ENDIF

PRINTFORML %CALLNAME:ARG%因为今天%LOCALS%而提出希望做避妊措施…
CALL KOJO_MESSAGE_SEND("EVENT",18,TARGET,1,0)
{
	CALL ASK_M("放弃",1,@"使用避孕套（剩余{ITEM:45}枚）",ITEM:45,@"给避孕药（剩余{ITEM:49}錠）",ITEM:49,
	"请求不戴套做", !TCVAR:懇願, "不、絶対要让你怀孕", (TEQUIP:TARGET:縄 || TEQUIP:TARGET:拘束 || CFLAG:TARGET:败犬))
}
IF RESULT == 1
	ITEM:45 -= 1
	PRINTL 戴上了避孕套
	TEQUIP:MASTER:避孕套 = 1
ELSEIF RESULT == 2
	ITEM:49 -= 1
	TCVAR:ARG:口服避孕薬 = 1
	PRINTFORML 给%CALLNAME:ARG%喝了避孕药 
ELSEIF RESULT == 3
	TCVAR:ARG:懇願 = 1
	CALL OGAMITAOSHI(ARG)
	SIF RESULT == -1
		RETURN -1
ELSEIF RESULT == 4
	PRINTFORML 强行进入%CALLNAME:ARG%的身体 
	TCVAR:ARG:强行 = 1
ELSE
	PRINTFORML 虽然很遗憾但是还是放弃吧
	RESULT = -1
	RETURN -1
ENDIF

@避妊要求(ARG)
SIF CFLAG:ARG:允许无套  == 2
	RETURN
SIF !妊娠可否(ARG)
	RETURN
SIF !HAS_PENIS(MASTER)
	RETURN
SIF TALENT:ARG:無知
	RETURN
SIF TFLAG:16
	RETURN
SIF TCVAR:ARG:强行
	RETURN
SIF !SHIRAHU(ARG)
	RETURN
SIF TCVAR:ARG:挿入拒絶
	RETURN -1
;安全日
SIF ESTRUS_CYCLE(ARG) == 15
	RETURN
IF !CFLAG:ARG:允许无套
	CALL HININSHITE(ARG)
ELSEIF ESTRUS_CYCLE(ARG) == 150
	CALL HININSHITE(ARG)
ENDIF
SIF RESULT == -1
	RETURN -1


@妊娠可否(ARG)
#FUNCTION
SIF TEQUIP:PLAYER:避孕套 || TCVAR:ARG:口服避孕薬
	RETURNF 0
SIF TALENT:ARG:幼稚 && !TALENT:ARG:初潮
	RETURNF 0
SIF ((CHECK_CHARA(ARG, "幽霊") || CHECK_CHARA(ARG, "人形") || CHECK_CHARA(ARG, "蓬莱人")) && !CFLAG:ARG:兒童人数) || TALENT:ARG:妊娠
	RETURNF 0
RETURNF 1

@AUTO_CONTRACEPTION(ARG)
IF CFLAG:ARG:妊娠経過日数 <= 9 && TALENT:ARG:妊娠 && CFLAG:ARG:妊娠経過日数 >= 4
	PRINTFORMW 到安定期之前还是不要了
	RETURN -1
ENDIF
IF CFLAG:ARG:妊娠経過日数 > 25 && TALENT:ARG:妊娠
	PRINTFORMW 因为担心小孩所以还是不要了
	RETURN -1
ENDIF
SIF !TALENT:ARG:育児中
	RETURN
SIF !HAS_PENIS(MASTER)
	RETURN
SIF TEQUIP:PLAYER:避孕套 || TCVAR:ARG:口服避孕薬
	RETURN
SIF CFLAG:ARG:出産経過日 >= CHILD_就学
	RETURN
PRINTFORML 因为不想给育児中的%CALLNAME:ARG%增加負担所以还是避妊吧
CALL ASK_M("戴避孕套",ITEM:避孕套,"喝口服避孕薬",ITEM:口服避孕薬,"放弃",1)
SELECTCASE RESULT
	CASE 0
		ITEM:避孕套 --
		TEQUIP:PLAYER:避孕套 = 1
		PRINTL 戴上了避孕套
		RETURN 1
	CASE 1
		ITEM:口服避孕薬 --
		TCVAR:ARG:口服避孕薬 = 1
		PRINTFORML 给%CALLNAME:ARG%喝了避孕药 
		RETURN 1
	CASE 2
		PRINTFORML 虽然很遗憾但是还是放弃了
		RETURN -1
ENDSELECT

@ChkBeforeInsert(ARG)
CALL AUTO_SKIN_EQUIP
IF GROUPMATCH(TALENT:ARG:処女, 1, -1)
	CALL LOST_VIRGIN_STOP(ARG)
	SIF RESULT == -1
		RETURN -1
ENDIF
CALL AUTO_CONTRACEPTION(ARG)
SIF RESULT == -1
	RETURN -1
CALL 避妊要求(ARG)
IF RESULT == -1
	RETURN -1
ENDIF